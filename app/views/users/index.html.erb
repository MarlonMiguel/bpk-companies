<div id="users" class="users-table">
  <h2>Lista de usuários</h2>

    <!-- Filtros -->
  <%= form_with url: users_path, method: :get, local: true, class: "mb-3" do |f| %>
    <div class="row">
        <div class="col-md-2">
            <%= f.label :name, "Nome", class: "form-label" %>
            <%= f.text_field :name, class: "form-control", value: params[:name] %>
        </div>
        <div class="col-md-3">
            <%= f.label :email, "E-mail", class: "form-label" %>
            <%= f.text_field :email, class: "form-control", value: params[:email] %>
        </div>
        <div class="col-md-3">
            <%= f.label :phone, "Telefone", class: "form-label" %>
            <%= f.text_field :phone, class: "form-control", value: params[:phone] %>
        </div>
        <div class="col-md-2">
            <%= f.label :active, "Status", class: "form-label" %>
            <%= f.select :active, [["Ativo", true], ["Inativo", false]], { include_blank: "Selecione um status" }, class: "form-select" %>
        </div>
        <div class="col-md-2 mt-3">
            <%= f.submit "Buscar", class: "btn btn-sm btn-primary" %>
            <%= link_to "Limpar", users_path, class: "btn btn-sm btn-secondary" %>
        </div>
    </div>

  <% end %>

    <table class="table">
        <thead>
        <tr>
            <th>Nome</th>
            <th>Telefone</th>
            <th>E-mail</th>
            <th>Tipo usuário</th>
            <th>Categorias</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody>
        <% @users.each do |user| %>
            <tr>
            <td><%= user.name %></td>
            <td><%= user.phone %></td>
            <td><%= user.email %></td>
            <td><%= user.role %></td>
            <td>
                <% user.categories.each do |category| %>
                <span class="badge bg-primary"><%= category.description %></span>
                <% end %>
            </td>
            <td>
                <%= user.active? ? 'Ativo' : 'Inativo' %>
            </td>
            <td>
            <%= form_with url: toggle_active_user_path(user.id, locale: I18n.locale), method: :patch, class: 'd-inline' do %>
                <%= button_tag type: 'submit', class: 'btn btn-sm', title: user.active? ? 'Desativar usuário' : 'Ativar usuário', data: { bs_toggle: 'tooltip' }, 
                    style: "color: white; background-color: #{user.active? ? '#28a745' : '#dc3545'}; border-color: #{user.active? ? '#dc3545' : '#28a745'};" do %>
                <i class="bi <%= user.active? ? 'bi-toggle-on' : 'bi-toggle-off' %>"></i>
                <% end %>
            <% end %>
            
            <%= link_to manage_categories_user_path(user, locale: I18n.locale), class: "btn btn-sm btn-info", title: "Gerenciar categorias", data: { bs_toggle: "tooltip" } do %>
                <i class="bi bi-gear"></i>
            <% end %>
            
            <%= link_to user_path(user, locale: I18n.locale), class: "btn btn-sm btn-secondary", title: "Visualizar usuário", data: { bs_toggle: "tooltip" } do %>
                <i class="bi bi-eye"></i>
            <% end %>
            </td>
            </tr>
        <% end %>
        </tbody>
    </table>

    <div class="pagination">
        <ul class="pagination pagination-sm justify-content-center">
        <% if @page > 1 %>
            <li class="page-item">
            <%= link_to '«', users_path(page: @page - 1, locale: I18n.locale), class: 'page-link' %>
            </li>
        <% end %>

        <% (1..@total_pages).each do |p| %>
            <li class="page-item <%= 'active' if p == @page %>">
            <%= link_to p, users_path(page: p, locale: I18n.locale), class: 'page-link' %>
            </li>
        <% end %>

        <% if @page < @total_pages %>
            <li class="page-item">
            <%= link_to '»', users_path(page: @page + 1, locale: I18n.locale), class: 'page-link' %>
            </li>
        <% end %>
        </ul>
    </div>
    </div>
